package lumicode.agendaja.api.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import lumicode.agendaja.api.model.Salario;

public interface SalarioRepository 
	extends JpaRepository<Salario, Long>{
	@Query("SELECT s FROM Salario as s "
			+ "INNER JOIN s.funcionario as f WHERE f.idFuncionario = ?1")
	public Salario pegarSalarioDeFuncionario(Long idFuncionario);
	
	
	@Query(value = "SELECT " + 
			"SUM(s.preco) AS total_comissao " +
			"FROM tbl_funcionario AS f " + 
			"INNER JOIN tbl_salario AS sa " + 
			"ON f.id_salario = sa.id_salario " + 
			"INNER JOIN tbl_tipo_salario AS ts " + 
			"ON sa.id_tipo_salario = ts.id_tipo_salario " + 
			"INNER JOIN tbl_agendamento AS a " + 
			"ON f.id_funcionario = a.id_funcionario " + 
			"INNER JOIN tbl_agendamento_servico AS ase " + 
			"ON a.id_agendamento = ase.id_agendamento " + 
			"INNER JOIN tbl_servico AS s " + 
			"ON ase.id_servico = s.id_servico " + 
			"WHERE f.id_funcionario = ?1", nativeQuery = true)
	public Double totalDeComissao(long idFuncionario);
	
}
